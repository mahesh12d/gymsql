I am building a SQL Solver Platform (with FastAPI + Postgres) and I want to integrate Redis to improve performance and scalability.

ğŸ”¹ Redis Use-Cases to Implement
1. Job Queue for SQL Submissions

When a user submits a SQL solution:

Push job into Redis queue (LPUSH problems:queue).

Job format (JSON):

{
  "job_id": "uuid123",
  "user_id": 42,
  "problem_id": 103,
  "sql": "SELECT dept, COUNT(*) FROM employees GROUP BY dept"
}


Worker consumes jobs using BRPOP problems:queue.

While processing, mark job in Redis:

HSET problems:processing:uuid123 status "running" user_id 42 problem_id 103


Once done:

Store result in Redis with TTL 5 minutes:

SETEX problems:result:uuid123 300 '{"status":"success","rows":10}'


Persist permanent record into Postgres submissions table.

âœ… Expected: Generate FastAPI endpoint for /problems/submit and worker code for consuming jobs.

2. Result Caching

Before executing SQL, check if Redis has cached result for (user_id, problem_id).

GET cache:result:{user_id}:{problem_id}


If exists â†’ return cached result.

If not, run SQL â†’ store result in Redis for 5â€“10 min TTL.

SETEX cache:result:42:103 600 '{"status":"success","rows":10}'


âœ… Expected: Add caching logic in submission workflow.

3. Leaderboards

Track number of solved problems per user using Redis Sorted Sets.

ZINCRBY leaderboard:global 1 user:42
ZINCRBY leaderboard:topic:joins 1 user:42


Fetch top 10 users globally:

ZREVRANGE leaderboard:global 0 9 WITHSCORES


Fetch user rank:

ZREVRANK leaderboard:global user:42


âœ… Expected: Generate FastAPI endpoints:

/leaderboard/global

/leaderboard/topic/{topic}

/leaderboard/user/{id}

ğŸ”¹ Postgres Schema (SQLAlchemy Models)

Please generate models for:

Users

id, username, email, created_at

Submissions

id, user_id, problem_id, sql_query, status, rows_returned, created_at

ğŸ”¹ Tech Stack

Backend: FastAPI (Python)

Database: Postgres (Neon)

Cache/Queue: Redis (Upstash or Docker local)

ORM: SQLAlchemy + Alembic

ğŸ”¹ Expected Output

FastAPI routes:

/problems/submit (enqueue + caching)

/problems/result/{job_id} (fetch result from Redis â†’ fallback to Postgres)

/leaderboard/global (top N users)

/leaderboard/topic/{topic} (topic-specific leaderboard)

/leaderboard/user/{id} (user rank + score)

Worker script:

Consumes from problems:queue

Executes query

Stores results in Redis + Postgres

Example Redis commands with Python redis-py client.

ğŸ”¹ Example Workflows
ğŸ“ SQL Submission Flow
User â†’ FastAPI (/problems/submit)
   â†’ Redis (LPUSH problems:queue)
   â†’ Worker (BRPOP queue)
   â†’ Executes SQL
   â†’ SETEX problems:result:{id}
   â†’ INSERT INTO Postgres (submissions)
User â†’ FastAPI (/problems/result/{id})
   â†’ GET Redis (result cache) â†’ fallback to Postgres

ğŸ† Leaderboard Flow
User solves problem
   â†’ Redis (ZINCRBY leaderboard:global 1 user:{id})
   â†’ Redis (ZINCRBY leaderboard:topic:{topic} 1 user:{id})
Leaderboard endpoint
   â†’ ZREVRANGE leaderboard:global 0 9 WITHSCORES
   â†’ ZREVRANK leaderboard:global user:{id}


âœ… Please generate:

FastAPI backend code with Redis + Postgres integrated.

SQLAlchemy models for Postgres tables.

Redis key usage examples.

Worker script for queue consumption.

Clear comments for each step.